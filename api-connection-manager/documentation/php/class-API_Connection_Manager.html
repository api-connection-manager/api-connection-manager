<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="generator" content="ApiGen 2.7.0" />

	<title>Class API_Connection_Manager</title>

	<script type="text/javascript" src="resources/combined.js?2398159053"></script>
	<script type="text/javascript" src="elementlist.js?1663450502"></script>
	<link rel="stylesheet" type="text/css" media="all" href="resources/style.css?1567499433" />

</head>

<body>
<div id="left">
	<div id="menu">
		<a href="index.html" title="Overview"><span>Overview</span></a>


		<div id="groups">
			<h3>Packages</h3>
			<ul>
				<li class="active"><a href="package-api.connection.manager.html">api-connection-manager</a>
						</li>
				<li><a href="package-david.coombes.html">david-coombes</a>
						</li>
			</ul>
		</div>

		<hr />


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li class="active"><a href="class-API_Connection_Manager.html">API_Connection_Manager</a></li>
				<li><a href="class-API_Connection_Manager_Setup.html">API_Connection_Manager_Setup</a></li>
			</ul>





			<h3>Functions</h3>
			<ul>
				<li><a href="function-api_connection_manager_dash.html">api_connection_manager_dash</a></li>
			</ul>
		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
<div id="rightInner">
	<form id="search">
		<input type="hidden" name="cx" value="" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text" name="q" class="text" />
		<input type="submit" value="Search" />
	</form>

	<div id="navigation">
		<ul>
			<li>
				<a href="index.html" title="Overview"><span>Overview</span></a>
			</li>
			<li>
				<a href="package-api.connection.manager.html" title="Summary of api-connection-manager"><span>Package</span></a>
			</li>
			<li class="active">
<span>Class</span>			</li>
		</ul>
		<ul>
			<li>
				<a href="tree.html" title="Tree view of classes, interfaces, traits and exceptions"><span>Tree</span></a>
			</li>
			<li>
				<a href="todo.html" title="Todo list"><span>Todo</span></a>
			</li>
		</ul>
		<ul>
		</ul>
	</div>

<div id="content" class="class">
	<h1>Class API_Connection_Manager</h1>


	<div class="description">
	
<p>class-wp-services-api</p>

<p>This class uses params stored in a module file to connect to remote services.
It manages the storing of access_tokens and refresh_tokens in the oauth2 spec
and also allows for custom service api's to be connected to.</p>

<p>Plugins can then easily connect to these services and make requests.
Developers can also easily create new modules with the params for different
services.</p>

<p>Currently only one service can be requested at a time. As each service more
than likely has its own params, even if two or more services had similar params
they would still be individual calls made by the wp_response_* helper functions.
Also if more than one service was requested and they required login, it would be
unfeasible to have multpile login screens.</p>

<p>Requests made to this api will then check that the user is logged into that
service. If they are not and the service is active then the developer should be
able to call a login screen for that service. Some services require that a new
tab be opened, some require only a popup with a form.</p>

<p><b>N.B.</b> Although wordpress mixes and jumps between slugs and index files
when working with plugins, for this class the index file and the slug are the
same and the one. So the slug for a module stored at:
api-con-mng-modules/google-login/index.php the slug would then be:
google-login/index.php The reason for this is that the index file is the only
definite unique item between different modules. Two developers giving two
modules the same slug by accident could cause headaches. Using the index.php
file makes this impossible. Don't forget to urlencode() your slugs before using
them in forms etc. Also don't forget to urldecode() your slugs when parsing form
submits.</p>

	</div>









	<div class="info">
		
		
		
		<b>Package:</b> <a href="package-api.connection.manager.html">api-connection-manager</a><br />

				<b>Author:</b>
				daithi<br />
				<b>Todo:</b>
				localization<br />
				<b>Todo:</b>
				refresh token<br />
				<b>Todo:</b>
				research google's AuthSub or ClientLogin api's. Might have something to help
building for custom services.<br />
				<b>Todo:</b>
				move query_append() from debug.func.php to method in this class<br />
				<b>Todo:</b>
				look into a sevices datatype/object that plugins would request and work of.
Something like WP_Service. WP_Service-&gt;get_grant_uri or
WP_Service-&gt;get_btn<br />
				<b>Todo:</b>
				create a DTO object to return from calls to the api. The DTO would therefore
always be based on a server response. This helps keep with the wordpress norm of
accepting strings and returning objects. ie where calls to get_user* functions
return a WP_User object, calls to this api would return a WP_DTO object for the
plugin dev's to work with.<br />
				<b>Todo:</b>
				write up standard for module index.php files. Clean out old vars and allow for
more header options.<br />
				<b>Todo:</b>
				activation/deactivation of services<br />
		<b>Located at</b> <a href="source-class-API_Connection_Manager.html#2" title="Go to source code">class-api-connection-manager.php</a><br />
	</div>


	<table class="summary" id="methods">
	<caption>Methods summary</caption>
	<tr data-order="__construct" id="___construct">

		<td class="attributes"><code>
			 public 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#___construct">#</a>
		<code><a href="source-class-API_Connection_Manager.html#71" title="Go to source code">__construct</a>( )</code>

		<div class="description short">
			
<p>Loads settings and set default params.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Loads settings and set default params.</p>








		</div>
		</div></td>
	</tr>
	<tr data-order="connect" id="_connect">

		<td class="attributes"><code>
			 public 
			die()&#039;s
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_connect">#</a>
		<code><a href="source-class-API_Connection_Manager.html#97" title="Go to source code">connect</a>( <span>type <var>$slug</var></span>, <span> <var>$die</var> = <span class="php-keyword1">true</span></span> )</code>

		<div class="description short">
			
<p>Connects to a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Connects to a service.</p>

<p>First checks if user is logged in, if not then displays login form. Most
oauth2 login forms will be a new browser tab. Once logged in correctly the
return_uri will print javascript to pass back success to the plugin gui.</p>

<p>The gui can then make another request, which when this is called will return
true if user is logged into service</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>type</code></dd>
					<dt><var>$die</var></dt>
					<dd></dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>die()&#039;s</code><br>on failure, returns true on success.<br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="get_login_button" id="_get_login_button">

		<td class="attributes"><code>
			 public 
			string
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_get_login_button">#</a>
		<code><a href="source-class-API_Connection_Manager.html#146" title="Go to source code">get_login_button</a>( <span>string <var>$slug</var></span>, <span>mixed <var>$file</var></span>, <span> <var>$callback</var></span> )</code>

		<div class="description short">
			
<p>WP Plugin method. Returns the html for a module's login link.</p>

		</div>

		<div class="description detailed hidden">
			
<p>WP Plugin method. Returns the html for a module's login link.</p>

<p>This is a possible helper function that will return the button or html for an
oauth2 token url.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The index filename of the sub-module.</dd>
					<dt><var>$file</var></dt>
					<dd><code>mixed</code><br>$callback Callback function in same string|array format as used by add_action.</dd>
					<dt><var>$callback</var></dt>
					<dd></dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>string</code><br>Returns the html.<br />
				</div>


				<h4>Todo</h4>
				<div class="list">
						allow button sizes (small|medium|large)<br />
						remove file check. Get params from $this-&gt;services[]<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="get_service" id="_get_service">

		<td class="attributes"><code>
			 public 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_get_service">#</a>
		<code><a href="source-class-API_Connection_Manager.html#249" title="Go to source code">get_service</a>( <span>string <var>$slug</var></span> )</code>

		<div class="description short">
			
<p>Returns the details for a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns the details for a service.</p>

<p>Returns module details, service params and service options.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The service index_file</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="get_services" id="_get_services">

		<td class="attributes"><code>
			 public 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_get_services">#</a>
		<code><a href="source-class-API_Connection_Manager.html#272" title="Go to source code">get_services</a>( <span>string <var>$type</var> = <span class="php-quote">'inactive'</span> </span> )</code>

		<div class="description short">
			
<p>Returns a list of services.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns a list of services.</p>

<p>This is the main method for plugins to get services from.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$type</var></dt>
					<dd><code>string</code><br> The type of services active|inactive Default active.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br />
				</div>


				<h4>Todo</h4>
				<div class="list">
						change default to active.<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="request" id="_request">

		<td class="attributes"><code>
			 public 
			response|WP_Error
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_request">#</a>
		<code><a href="source-class-API_Connection_Manager.html#286" title="Go to source code">request</a>( <span>string <var>$slug</var></span>, <span>array <var>$req</var></span>, <span> <var>$headers</var> = <span class="php-keyword1">null</span> </span> )</code>

		<div class="description short">
			
<p>Makes a request to a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Makes a request to a service.</p>

<p>Uses the native wordpress wp_response_* wrappers for the WP_HTTP class to
make requests. Any variables that are need across different service either come
from the params in the module file or are set using the API settings page.</p>

<p>The request array takes the following parameters: $req = array( 'uri'
//required 'method' //defaults to post 'params' //params to send for both GET
and POST requests );</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The service slug to connect to.</dd>
					<dt><var>$req</var></dt>
					<dd><code>array</code><br> The request array</dd>
					<dt><var>$headers</var></dt>
					<dd></dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>response|WP_Error</code><br>Returns the response DTO or error if failed.<br />
				</div>


				<h4>Todo</h4>
				<div class="list">
						change params array to match the WP_HTTP class for requests.<br />
						this method<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_check_modules_dir" id="__check_modules_dir">

		<td class="attributes"><code>
			 public 
			boolean
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__check_modules_dir">#</a>
		<code><a href="source-class-API_Connection_Manager.html#353" title="Go to source code">_check_modules_dir</a>( )</code>

		<div class="description short">
			
<p>Check if sub-modules directory exists.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Check if sub-modules directory exists.</p>

<p>If the directory doesn't exist tries to create it using the wordpress
Filesystem_API class. As the ftp login will be displayed this method should be
called from the dashboard/network admin settings page.</p>




				<h4>Returns</h4>
				<div class="list">
					<code>boolean</code><br />
				</div>

				<h4>Throws</h4>
				<div class="list">
					<code>Exception</code><br>If the sub-modules directory can't be created.<br />
				</div>



		</div>
		</div></td>
	</tr>
	<tr data-order="_error" id="__error">

		<td class="attributes"><code>
			 private 
			WP_Error
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__error">#</a>
		<code><a href="source-class-API_Connection_Manager.html#395" title="Go to source code">_error</a>( <span>string <var>$msg</var></span> )</code>

		<div class="description short">
			
<p>Returns a WP_Error object.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns a WP_Error object.</p>

<p>Sets the error code to 'API Connection Manager' and returns a constructed
WP_Error object. Sets the last_error param to error message.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$msg</var></dt>
					<dd><code>string</code><br> The error message</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>WP_Error</code><br />
				</div>


				<h4>Uses</h4>
				<div class="list">
						<code><code><a href="class-API_Connection_Manager.html#$last_error">API_Connection_Manager::<var>$last_error</var></a></code></code> <br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_get_installed_services" id="__get_installed_services">

		<td class="attributes"><code>
			 private 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__get_installed_services">#</a>
		<code><a href="source-class-API_Connection_Manager.html#416" title="Go to source code">_get_installed_services</a>( )</code>

		<div class="description short">
			
<p>Builds an array of all installed services and their params.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Builds an array of all installed services and their params.</p>

<p>The return array is split into active and inactive services. There are a lot
of system calls and working with files. Overuse of this method would not be
advised.</p>

<p>Currently this method is used in: - API_Connection_Manager::__construct() -
API_Connection_Manager::get_services //only if no services loaded yet</p>




				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_get_options" id="__get_options">

		<td class="attributes"><code>
			 private 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__get_options">#</a>
		<code><a href="source-class-API_Connection_Manager.html#527" title="Go to source code">_get_options</a>( )</code>

		<div class="description short">
			
<p>Get options.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Get options.</p>

<p>If multisite install will take options from get_site_option() if not then
defaults to get_option()</p>




				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br />
				</div>


				<h4>Todo</h4>
				<div class="list">
						this method is being called too much<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_get_options_transient" id="__get_options_transient">

		<td class="attributes"><code>
			 private 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__get_options_transient">#</a>
		<code><a href="source-class-API_Connection_Manager.html#548" title="Go to source code">_get_options_transient</a>( <span>string <var>$key</var> = <span class="php-quote">''</span> </span> )</code>

		<div class="description short">
			
<p>Returns transient options.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns transient options.</p>

<p>If mutlisite then will use get_site_transient() if not will default to
get_transient()</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$key</var></dt>
					<dd><code>string</code><br> The option key.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_get_params" id="__get_params">

		<td class="attributes"><code>
			 private 
			array|WP_Error
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__get_params">#</a>
		<code><a href="source-class-API_Connection_Manager.html#567" title="Go to source code">_get_params</a>( <span>string <var>$slug</var></span> )</code>

		<div class="description short">
			
<p>Loads a services module file (index.php) into the current namespace and
returns the params for a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Loads a services module file (index.php) into the current namespace and
returns the params for a service.</p>

<p>If there is an error including the file a WP_Error is returned. Returns true
on success.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The sevice slug</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array|WP_Error</code><br>Returns error if file can't be loaded or options for service aren't set.<br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_get_service_options" id="__get_service_options">

		<td class="attributes"><code>
			 public 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__get_service_options">#</a>
		<code><a href="source-class-API_Connection_Manager.html#642" title="Go to source code">_get_service_options</a>( <span>string <var>$slug</var></span> )</code>

		<div class="description short">
			
<p>Returns the options for a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns the options for a service.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The services module's index file.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_get_token" id="__get_token">

		<td class="attributes"><code>
			 private 
			string|WP_Error
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__get_token">#</a>
		<code><a href="source-class-API_Connection_Manager.html#658" title="Go to source code">_get_token</a>( <span>string <var>$slug</var></span>, <span>string <var>$type</var> = <span class="php-quote">'access'</span> </span> )</code>

		<div class="description short">
			
<p>Returns the access_token for the current user for a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns the access_token for the current user for a service.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The service slug</dd>
					<dt><var>$type</var></dt>
					<dd><code>string</code><br> Default access. Whether to return refresh or access tokens.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>string|WP_Error</code><br>Returns the token or WP_Error if none found.<br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_module_activate" id="__module_activate">

		<td class="attributes"><code>
			 public 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__module_activate">#</a>
		<code><a href="source-class-API_Connection_Manager.html#683" title="Go to source code">_module_activate</a>( <span>string|array <var>$slugs</var></span> )</code>

		<div class="description short">
			
<p>Activate modules.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Activate modules.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slugs</var></dt>
					<dd><code>string|array</code><br> A string or array of slugs.</dd>
				</dl></div>





		</div>
		</div></td>
	</tr>
	<tr data-order="_module_deactivate" id="__module_deactivate">

		<td class="attributes"><code>
			 public 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__module_deactivate">#</a>
		<code><a href="source-class-API_Connection_Manager.html#729" title="Go to source code">_module_deactivate</a>( <span>string|array <var>$slugs</var></span> )</code>

		<div class="description short">
			
<p>Deactivate modules.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Deactivate modules.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slugs</var></dt>
					<dd><code>string|array</code><br> A string or array of slugs.</dd>
				</dl></div>





		</div>
		</div></td>
	</tr>
	<tr data-order="_response_listener" id="__response_listener">

		<td class="attributes"><code>
			 public 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__response_listener">#</a>
		<code><a href="source-class-API_Connection_Manager.html#775" title="Go to source code">_response_listener</a>( )</code>

		<div class="description short">
			
<p>Ajax callback</p>

		</div>

		<div class="description detailed hidden">
			
<p>Ajax callback</p>

<p>Bootstraps all response's to the api connection manager. Both secure and
non-secure response are parsed here (wp_ajax &amp;&amp; wp_ajax_nopriv).</p>

<p>Called by hook 'plugins_loaded' to ensure all plugins dependant on the api
are loaded. This method needs to do its own checking for ajax calls.</p>






				<h4>Todo</h4>
				<div class="list">
						test security.<br />
						There maybe need to tell if a response was for a logged in user or not. ie if it
was wp_ajax or wp_ajax_nopriv. One idea would be to set a flag in the construct
if wp_ajax_nopriv_(this_func) was requested?<br />
						should be private?<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_service_do_callback" id="__service_do_callback">

		<td class="attributes"><code>
			 private 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__service_do_callback">#</a>
		<code><a href="source-class-API_Connection_Manager.html#835" title="Go to source code">_service_do_callback</a>( <span>string <var>$unique</var></span>, <span>stdClass <var>$dto</var></span> )</code>

		<div class="description short">
			
<p>Calls a callback, if one is set.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Calls a callback, if one is set.</p>

<p>Checks the state variable in a dto against callbacks stored to get the file
and function|class to call. The dto is passed to the callback.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$unique</var></dt>
					<dd><code>string</code><br> The state variable to test agains</dd>
					<dt><var>$dto</var></dt>
					<dd><code>stdClass</code><br> The dto response</dd>
				</dl></div>



				<h4>See</h4>
				<div class="list">
						<code><code><a href="class-API_Connection_Manager.html#_">API_Connection_Manager::_service_parse_dto()</a></code></code><br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_service_get_account_emails" id="__service_get_account_emails">

		<td class="attributes"><code>
			 private 
			emails
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__service_get_account_emails">#</a>
		<code><a href="source-class-API_Connection_Manager.html#912" title="Go to source code">_service_get_account_emails</a>( <span>string <var>$slug</var></span>, <span>string <var>$access_token</var></span> )</code>

		<div class="description short">
			
<p>Returns the emails for an account on a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Returns the emails for an account on a service.</p>

<p>Is used for logging and testing access_tokens.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The service slug</dd>
					<dt><var>$access_token</var></dt>
					<dd><code>string</code><br> The access token</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>emails</code><br />
				</div>


				<h4>Todo</h4>
				<div class="list">
						change so always returns an array instead of string|array<br />
						use oauth2's token checking calls instead<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_service_oauth2_login" id="__service_oauth2_login">

		<td class="attributes"><code>
			 private 
			WP_User|WP_Error
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__service_oauth2_login">#</a>
		<code><a href="source-class-API_Connection_Manager.html#954" title="Go to source code">_service_oauth2_login</a>( <span>stdClass <var>$dto</var></span> )</code>

		<div class="description short">
			
<p>Takes a dto object returned from an oauth2 grant request and logs in wp
user.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Takes a dto object returned from an oauth2 grant request and logs in wp
user.</p>

<p>Uses the params set in the services modules index file to request, first a
token, then use that token to request an email account. Search's wp users for
email match and if one is found will then log in the user and return the WP_User
object.</p>

<p>Will return WP_Error on failure.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$dto</var></dt>
					<dd><code>stdClass</code><br> a dto object returned by $this-&gt;parse_dto()</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>WP_User|WP_Error</code><br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_service_parse_dto" id="__service_parse_dto">

		<td class="attributes"><code>
			 private 
			stdClass|WP_error
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__service_parse_dto">#</a>
		<code><a href="source-class-API_Connection_Manager.html#1075" title="Go to source code">_service_parse_dto</a>( <span>array <var>$response</var></span> )</code>

		<div class="description short">
			
<p>Parses an array to a DTO for use with this class.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Parses an array to a DTO for use with this class.</p>

<p>The format of the returned DTO is:</p>

<p>$res = new stdClass(); $res-&gt;response = array(); //the module defined dto
$res-&gt;slug = ""; $res-&gt;user = "";</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$response</var></dt>
					<dd><code>array</code><br> An array to parse. Generally a $_REQUEST</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>stdClass|WP_error</code><br>Returns an error if no service slug found.<br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_service_set_token" id="__service_set_token">

		<td class="attributes"><code>
			 private 
			mixed
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__service_set_token">#</a>
		<code><a href="source-class-API_Connection_Manager.html#1117" title="Go to source code">_service_set_token</a>( <span>string <var>$slug</var></span>, <span>string <var>$token</var></span>, <span>integer|WP_User <var>$user</var></span>, <span>string <var>$type</var> = <span class="php-quote">'access'</span></span> )</code>

		<div class="description short">
			
<p>Set the access token for a user.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Set the access token for a user.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> The service slug</dd>
					<dt><var>$token</var></dt>
					<dd><code>string</code><br> The access token</dd>
					<dt><var>$user</var></dt>
					<dd><code>integer|WP_User</code><br> The user id or a WP_User object</dd>
					<dt><var>$type</var></dt>
					<dd><code>string</code><br>Default access. Whether storing access or refresh tokens.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>mixed</code><br>Returns the meta data.<br />
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="_set_callback" id="__set_callback">

		<td class="attributes"><code>
			 private 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__set_callback">#</a>
		<code><a href="source-class-API_Connection_Manager.html#1142" title="Go to source code">_set_callback</a>( <span>string <var>$file</var></span>, <span>mixed <var>$func</var></span>, <span>string <var>$unique</var></span> )</code>

		<div class="description short">
			
<p>Allows a function hook into the login process.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Allows a function hook into the login process.</p>

<p>In order for situations where the plugin may want to hook into the login
process after a login is successfull. Using normal wordpress's actions won't
work here because a successfull login from one request will trigger all
callbacks.</p>

<p>The callbacks therefore need to be unique and also stored in the database
This also means that there has to be a unique variable that can sent/recieved to
identify which callback should handle what request.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$file</var></dt>
					<dd><code>string</code><br> The full location to the file with the function.</dd>
					<dt><var>$func</var></dt>
					<dd><code>mixed</code><br> Either array of object &amp; method string pair or a function name as string.</dd>
					<dt><var>$unique</var></dt>
					<dd><code>string</code><br> Unique string that will be returned by the response to match up with the right
callback.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br>Returns the current callbacks that are set.<br />
				</div>


				<h4>Todo</h4>
				<div class="list">
						use nonce created in service link as key for callback<br />
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="_set_option_transient" id="__set_option_transient">

		<td class="attributes"><code>
			 private 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__set_option_transient">#</a>
		<code><a href="source-class-API_Connection_Manager.html#1187" title="Go to source code">_set_option_transient</a>( <span>string <var>$key</var> = <span class="php-quote">''</span></span>, <span>array <var>$options</var></span>, <span>integer <var>$expiration</var> = <span class="php-num">10</span></span> )</code>

		<div class="description short">
			
<p>Sets temporary options.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Sets temporary options.</p>

<p>Sets options that will expire in x amount of seconds such as callbacks for
login hooks.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$key</var></dt>
					<dd><code>string</code><br> Options identifiying string</dd>
					<dt><var>$options</var></dt>
					<dd><code>array</code><br> The options array</dd>
					<dt><var>$expiration</var></dt>
					<dd><code>integer</code><br> Time to expire. Default 10 seconds.</dd>
				</dl></div>





		</div>
		</div></td>
	</tr>
	<tr data-order="_set_option" id="__set_option">

		<td class="attributes"><code>
			 private 
			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__set_option">#</a>
		<code><a href="source-class-API_Connection_Manager.html#1209" title="Go to source code">_set_option</a>( <span>array <var>$options</var></span> )</code>

		<div class="description short">
			
<p>Sets the API's options.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Sets the API's options.</p>

<p>If multisite install will set site options, if not then normal wp options.
Will update the services member with the new options.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$options</var></dt>
					<dd><code>array</code></dd>
				</dl></div>





		</div>
		</div></td>
	</tr>
	<tr data-order="_set_service_options" id="__set_service_options">

		<td class="attributes"><code>
			 public 
			array
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#__set_service_options">#</a>
		<code><a href="source-class-API_Connection_Manager.html#1246" title="Go to source code">_set_service_options</a>( <span>string <var>$slug</var></span>, <span>array <var>$options</var></span> )</code>

		<div class="description short">
			
<p>Set the options for a service.</p>

		</div>

		<div class="description detailed hidden">
			
<p>Set the options for a service.</p>



				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$slug</var></dt>
					<dd><code>string</code><br> Index file to service.</dd>
					<dt><var>$options</var></dt>
					<dd><code>array</code><br> An array of options.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					<code>array</code><br>Returns the new api options array<br />
				</div>


				<h4>Uses</h4>
				<div class="list">
						API_Connection_Manager::set_option()<br />
				</div>


		</div>
		</div></td>
	</tr>
	</table>







	<table class="summary" id="properties">
	<caption>Properties summary</caption>
	<tr data-order="last_error" id="$last_error">

		<td class="attributes"><code>
			public 
			string
		</code></td>

		<td class="name">
				<a href="source-class-API_Connection_Manager.html#60" title="Go to source code"><var>$last_error</var></a>
		</td>
		<td class="value"><code><span class="php-quote">&quot;&quot;</span></code></td>
		<td class="description"><div>
			<a href="#$last_error" class="anchor">#</a>

			<div class="description short">
				
<p>The last error made</p>

			</div>

			<div class="description detailed hidden">
				
<p>The last error made</p>


					<h4>Used by</h4>
					<div class="list">
							<code><code><a href="class-API_Connection_Manager.html#_">API_Connection_Manager::_error()</a></code></code> <br />
					</div>
			</div>
		</div></td>
	</tr>
	<tr data-order="services" id="$services">

		<td class="attributes"><code>
			public 
			array
		</code></td>

		<td class="name">
				<a href="source-class-API_Connection_Manager.html#62" title="Go to source code"><var>$services</var></a>
		</td>
		<td class="value"><code><span class="php-keyword1">array</span>()</code></td>
		<td class="description"><div>
			<a href="#$services" class="anchor">#</a>

			<div class="description short">
				
<p>List of all installed services</p>

			</div>

			<div class="description detailed hidden">
				
<p>List of all installed services</p>


			</div>
		</div></td>
	</tr>
	<tr data-order="dir_sub" id="$dir_sub">

		<td class="attributes"><code>
			protected 
			string
		</code></td>

		<td class="name">
				<a href="source-class-API_Connection_Manager.html#64" title="Go to source code"><var>$dir_sub</var></a>
		</td>
		<td class="value"><code><span class="php-quote">&quot;&quot;</span></code></td>
		<td class="description"><div>
			<a href="#$dir_sub" class="anchor">#</a>

			<div class="description short">
				
<p>The location of the submodules dir</p>

			</div>

			<div class="description detailed hidden">
				
<p>The location of the submodules dir</p>


			</div>
		</div></td>
	</tr>
	<tr data-order="option_name" id="$option_name">

		<td class="attributes"><code>
			protected 
			string
		</code></td>

		<td class="name">
				<a href="source-class-API_Connection_Manager.html#66" title="Go to source code"><var>$option_name</var></a>
		</td>
		<td class="value"><code><span class="php-quote">&quot;api-connection-manager&quot;</span></code></td>
		<td class="description"><div>
			<a href="#$option_name" class="anchor">#</a>

			<div class="description short">
				
<p>The name of the options var for this api</p>

			</div>

			<div class="description detailed hidden">
				
<p>The name of the options var for this api</p>


			</div>
		</div></td>
	</tr>
	<tr data-order="url_sub" id="$url_sub">

		<td class="attributes"><code>
			protected 
			string
		</code></td>

		<td class="name">
				<a href="source-class-API_Connection_Manager.html#68" title="Go to source code"><var>$url_sub</var></a>
		</td>
		<td class="value"><code><span class="php-quote">&quot;&quot;</span></code></td>
		<td class="description"><div>
			<a href="#$url_sub" class="anchor">#</a>

			<div class="description short">
				
<p>The url to the submodules dir</p>

			</div>

			<div class="description detailed hidden">
				
<p>The url to the submodules dir</p>


			</div>
		</div></td>
	</tr>
	</table>



</div>

	<div id="footer">
		 API documentation generated by <a href="http://apigen.org">ApiGen 2.7.0</a>
	</div>
</div>
</div>
</body>
</html>
